<!doctype html><html lang=zh>
<head><meta http-equiv=content-type content="text/html" charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href="/css/main.min.603bdac5a514a018c8a598608c9559e9356dee22c6203eb4ba7ad06c438010c7.css" integrity="sha256-YDvaxaUUoBjIpZhgjJVZ6TVt7iLGID60unrQbEOAEMc=">
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Lora&display=swap" rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css>
<script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/code-line></script><title>Django 框架学习笔记</title>
</head>
<body class="flex flex-col bg-gray-100">
<div class="flex my-8 font-serif">
<div class="flex-auto w-1/3">
<div class="w-64 h-full mr-2 ml-auto">
<div class=mb-8><div class="border rounded-lg shadow-md">
<div class="h-32 flex rounded-t-lg text-white" style=background-image:url(/images/background-1.jpg)>
<div class=m-auto>
<div class="text-center font-serif text-3xl my-2"><a href=/>Noth</a></div>
<div class="text-center font-serif">去码头整点薯条</div>
</div>
</div>
<nav class="rounded-b-lg bg-white">
<ul class="py-2 ml-8">
<li class="my-2 content-center">
<a href=/ class=hover:text-red-300><i class="fas fa-home"></i>&nbsp;&nbsp;&nbsp;主页</a>
</li>
<li class="my-2 content-center">
<a href=/metapages/archive/ class=hover:text-red-300><i class="fas fa-scroll"></i>&nbsp;&nbsp;归档</a>
</li>
<li class="my-2 content-center">
<a href=/categories/ class=hover:text-red-300><i class="fas fa-th"></i>&nbsp;&nbsp;&nbsp;分类</a>
</li>
<li class="my-2 content-center">
<a href=/tags/ class=hover:text-red-300><i class="fas fa-tags"></i>&nbsp;&nbsp;标签</a>
</li>
<li class="my-2 content-center">
<a href=/metapages/link/ class=hover:text-red-300><i class="fas fa-link"></i>&nbsp;&nbsp;&nbsp;链接</a>
</li>
<li class="my-2 content-center">
<a href=/metapages/message/ class=hover:text-red-300><i class="fas fa-comment-alt"></i>&nbsp;&nbsp;&nbsp;留言</a>
</li>
</ul>
</nav>
</div></div>
<div class="sticky top-2">
<div class=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#intro>Intro</a></li>
<li><a href=#django-初窥>django 初窥</a>
<ul>
<li><a href=#steps>Steps</a></li>
<li><a href=#django-shell>django shell</a></li>
<li><a href=#django-admin>django admin</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div class="flex-auto w-2/3">
<div class="w-200 border rounded-lg bg-white ml-2 mr-auto px-4">
<h1 class="font-serif text-4xl text-center mt-8 mb-2">Django 框架学习笔记</h1>
<div class="text-right text-gray-500 mr-20">
<span>
Mar. 25, 2021 |
<i class="far fa-bookmark"></i>
</span>
</div>
<div class="content px-6 mb-8">
<h2 id=intro>Intro</h2>
<p>Django 最初被设计用于具有快速开发需求的新闻类站点，目的是要实现简单快捷的网站开发。因此，可以使用 django 快速实现一个数据库驱动的 Web 应用。</p>
<p>Django 使用 MTV 模式架构，即：Model（模型）、Template（模板）、View（视图）。其中 Model 与数据对应，一般来说，一个模型对应一张数据表；与其他一些框架一样，Template 负责使用一种动态的方式渲染页面，一般来说，模板中需要包含一个静态的 HTML 内容以及一些逻辑语法来动态的插入其他内容；View 部分则定义了网站的工作逻辑，即当接受到一个请求时，网站如何进行响应。</p>
<h2 id=django-初窥>django 初窥</h2>
<h3 id=steps>Steps</h3>
<p>使用各种开发工具、IDE等可以很方便的生成一个 django 的主要框架，但是这里为了理解方便使用命令行来创建一个 django 网站。在开始之前，首先需要先安装 django，使用<code>python -m django --version</code>可以查看是否安装 django，如果没有，需要首先安装<code>pip install django</code>。</p>
<ol>
<li>
<p>创建站点 <code>django-admin startproject mysite</code>：</p>
<ul>
<li>这个命令会在 mysite 目录下生成一个站点，其包含以下内容：</li>
<li><em>manage.py</em>：一个管理站点的命令行工具，之后的许多操作都要使用<code>python manage.py ...</code>实现；</li>
<li><em>mysite/__init__.py</em>：告诉 python 这是一个包；</li>
<li><em>mysiet/settings.py</em>：django配置文件；</li>
<li><em>mysite/urls.py</em>：django 站点的 url 声明，在这里定义网站接收到的请求交给谁处理；</li>
<li><em>mysite/asgi.py</em>：作为你的项目的运行在 ASGI 兼容的 Web 服务器上的入口；</li>
<li><em>mysite/wsgi.py</em>：作为你的项目的运行在 WSGI 兼容的 Web 服务器上的入口；</li>
<li>此时就可以使用<code>python manage.py runserver</code>启动网站了，如果可以正常访问，那么我们揪下来就可以创建一个 web应用了；</li>
</ul>
</li>
<li>
<p>创建应用 <code>python manage.py startapp webapp</code>：</p>
<ul>
<li>首先要进入 mysite 的目录，然后再执行这条命令；</li>
<li>这条命令会在 webapp 下创建一个应用，其包含以下几个文件：</li>
<li><em>webapp/__init__.py</em>：告诉 python 这是一个包；</li>
<li><em>webapp/admin.py</em>：一个默认的 webapp 管理应用；</li>
<li><em>webapp/apps.py</em>：可以认为是app的设置文件；</li>
<li><em>webapp/models.py</em>：应用的模型定义；</li>
<li><em>webapp/views.py</em>：应用的视图定义；</li>
<li><em>webapp/tests.py</em></li>
<li><em>webapp/migrations/__init__.py</em>：数据库迁移数据</li>
<li>除此之外，还可自己定义一个 <em>urls.conf</em> 文件，这样做的目的是降低耦合，也使站点的布局更加清晰；在接收到一个请求时，只需要将所有只想该应用的请求全部转发到 <em>webapp/urls.conf</em> 下，再有该文件进行具体由哪个视图处理；</li>
<li>创建完成之后，为了使该应用加入到该站点中，至少还需要两项设置：
<ul>
<li>在 <em>mysite/urls.py</em> 中增加该应用的 route；</li>
<li>在 <em>mysite/settings.py</em> 中增加该应用；</li>
</ul>
</li>
</ul>
</li>
<li>
<p>设计APP：</p>
<ul>
<li>设计模型</li>
<li>设计视图</li>
<li>设计模板</li>
</ul>
</li>
<li>
<p>修改 urlconf：</p>
<ul>
<li><em>mysite/urls.py</em>：
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py>urlpatterns <span style=color:#f92672>=</span> [
    path(<span style=color:#e6db74>&#39;webapp/&#39;</span>, include(<span style=color:#e6db74>&#39;webapp.urls&#39;</span>)),
    path(<span style=color:#e6db74>&#39;admin/&#39;</span>, admin<span style=color:#f92672>.</span>site<span style=color:#f92672>.</span>urls),
]
</code></pre></div></li>
<li><em>webapp/urls.py</em>：
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#f92672>from</span> django.urls <span style=color:#f92672>import</span> path
<span style=color:#f92672>from</span> . <span style=color:#f92672>import</span> views

urlpatterns <span style=color:#f92672>=</span> [
    path(<span style=color:#e6db74>&#39;&#39;</span>, views<span style=color:#f92672>.</span>index, name<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;index&#39;</span>),
]
</code></pre></div></li>
</ul>
</li>
<li>
<p>修改网站设置：</p>
<ul>
<li>主要需要做的事情有两件，目的是为了保证 app 的模型与数据库能正常工作；</li>
<li>INSTALLED_APPS = [&lsquo;webapp.apps.WebappConfig&rsquo;]</li>
<li>定义数据库蛇者：DATABASES = {}</li>
</ul>
</li>
<li>
<p>生成数据库迁移文件 <code>python makemigrations webapp</code>：</p>
<ul>
<li>这条命令会使 django 检测模型的修改，然后存储为一次迁移</li>
<li>可以使用<code>sqlmigrate</code>查看迁移的 sql 语句，假设迁移文件为<code>webapp/migrations/0001_initial.py</code>，那么可以使用<code>python manage.py sqlmigrate webapp 0001</code>查看迁移语句。</li>
</ul>
</li>
<li>
<p>保存迁移到数据库<code>python manage.py migrate</code>：</p>
<ul>
<li>该命令会所有还没有执行的迁移应用的数据库上</li>
</ul>
</li>
</ol>
<h3 id=django-shell>django shell</h3>
<p>使用 <code>python manage.py shell</code> 可以进入一个特定的交互式命令行，这个命令行中设置了 <strong>DJANGO_SETTINGS_MODULE</strong> 环境变量，可以使用这个命令行测试各种 django api。</p>
<h3 id=django-admin>django admin</h3>
<p>django 会默认生成一个后台管理界面，通过这个界面可以方便的进行一些数据库管理。</p>
<ol>
<li>首先需要创建一个管理员账户：<code>python manage.py createsuperuser</code></li>
<li>编辑 <code>webapp/admin.py</code> 文件，注册模型：
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-py data-lang=py><span style=color:#f92672>from</span> django.contrib <span style=color:#f92672>import</span> admin
<span style=color:#f92672>from</span> .models <span style=color:#f92672>import</span> ModelName

admin<span style=color:#f92672>.</span>site<span style=color:#f92672>.</span>register(ModelName)
</code></pre></div></li>
<li>启动开发服务器：<code>python manage.py runserver</code></li>
<li>访问管理员页面：<em>http://127.0.0.1:8000/admin</em></li>
</ol>
</div>
</div>
<div class=w-200>
<div id=gitalk></div>
<script>var gitalk=new Gitalk({clientID:'9a04c6b451fbce76511d',clientSecret:'430c540c77ecd6b59749c60f0341c057bd5320a0',repo:'Causa1ity.github.io',owner:'Causa1ity',admin:'Causa1ity',id:'/devops/python/django/',distractionFreeMode:!1});gitalk.render('gitalk')</script>
</div>
</div>
</div>
<script>CodeLine.initOnPageLoad({copyBtn:{show:!0,position:'top'},toggleBtn:{show:!1}})</script>
<div class="text-center my-8">
<span class="font-serif text-lg">
Powered By <a href=https://gohugo.io/ class="font-bold hover:text-blue-400">Hugo</a>
with theme <a href=https://github.com/causa1ity/hugo-theme-noth/ class="font-bold hover:text-blue-400">Noth</a>
</span>
</div></body>
</html>