<!doctype html><html lang=zh>
<head><meta http-equiv=content-type content="text/html" charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href="/css/main.min.603bdac5a514a018c8a598608c9559e9356dee22c6203eb4ba7ad06c438010c7.css" integrity="sha256-YDvaxaUUoBjIpZhgjJVZ6TVt7iLGID60unrQbEOAEMc=">
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Lora&display=swap" rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css>
<script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/code-line></script><title>攻防世界 Web 部分题解</title>
</head>
<body class="flex flex-col bg-gray-100">
<div class="flex my-8 font-serif">
<div class="flex-auto w-1/3">
<div class="w-64 h-full mr-2 ml-auto">
<div class=mb-8><div class="border rounded-lg shadow-md">
<div class="h-32 flex rounded-t-lg text-white" style=background-image:url(/images/background-1.jpg)>
<div class=m-auto>
<div class="text-center font-serif text-3xl my-2"><a href=/>Noth</a></div>
<div class="text-center font-serif">去码头整点薯条</div>
</div>
</div>
<nav class="rounded-b-lg bg-white">
<ul class="py-2 ml-8">
<li class="my-2 content-center">
<a href=/ class=hover:text-red-300><i class="fas fa-home"></i>&nbsp;&nbsp;&nbsp;主页</a>
</li>
<li class="my-2 content-center">
<a href=/metapages/archive/ class=hover:text-red-300><i class="fas fa-scroll"></i>&nbsp;&nbsp;归档</a>
</li>
<li class="my-2 content-center">
<a href=/categories/ class=hover:text-red-300><i class="fas fa-th"></i>&nbsp;&nbsp;&nbsp;分类</a>
</li>
<li class="my-2 content-center">
<a href=/tags/ class=hover:text-red-300><i class="fas fa-tags"></i>&nbsp;&nbsp;标签</a>
</li>
<li class="my-2 content-center">
<a href=/metapages/link/ class=hover:text-red-300><i class="fas fa-link"></i>&nbsp;&nbsp;&nbsp;链接</a>
</li>
<li class="my-2 content-center">
<a href=/metapages/message/ class=hover:text-red-300><i class="fas fa-comment-alt"></i>&nbsp;&nbsp;&nbsp;留言</a>
</li>
</ul>
</nav>
</div></div>
<div class="sticky top-2">
<div class=toc>
<nav id=TableOfContents>
<ul>
<li><a href=#view_source>view_source</a></li>
<li><a href=#robots>robots</a></li>
<li><a href=#backup>backup</a></li>
<li><a href=#cookie>cookie</a></li>
<li><a href=#disabled_button>disabled_button</a></li>
<li><a href=#weak_auth>weak_auth</a></li>
<li><a href=#simple_php>simple_php</a></li>
<li><a href=#get_post>get_post</a></li>
<li><a href=#xff_referer>xff_referer</a></li>
<li><a href=#webshell>webshell</a></li>
<li><a href=#command_execution>command_execution</a></li>
<li><a href=#simple_js>simple_js</a></li>
</ul>
</nav>
</div>
</div>
</div>
</div>
<div class="flex-auto w-2/3">
<div class="w-200 border rounded-lg bg-white ml-2 mr-auto px-4">
<h1 class="font-serif text-4xl text-center mt-8 mb-2">攻防世界 Web 部分题解</h1>
<div class="text-right text-gray-500 mr-20">
<span>
Mar. 8, 2020 |
<i class="far fa-bookmark"></i>
</span>
</div>
<div class="content px-6 mb-8">
<p>攻防世界是一个CTF联系平台，包含有各种类型的题目，难度不等，适合入门。</p>
<p>这里是攻防世界Web题目个人练习记录，本文为Web新手练习区的题目。</p>
<h2 id=view_source>view_source</h2>
<p>X老师让小宁同学查看一个网页的源代码，但小宁同学发现鼠标右键好像不管用了。
根据题目，很显然flag应该是藏在flag中，但是不能使用鼠标右键，但是我们可以使用快捷键或者F12调出控制台查看源码：
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/view_source.png alt=view_source></p>
<h2 id=robots>robots</h2>
<p>X老师上课讲了Robots协议，小宁同学却上课打了瞌睡，赶紧来教教小宁Robots协议是什么吧。</p>
<p>根据题目，这道题应该是要访问robots.txt文件的，robots是用来告诉搜索引擎获取资源的一个文件，具体如下：</p>
<blockquote>
<p>robots.txt（统一小写）是一种存放于网站根目录下的ASCII编码的文本文件，它通常告诉网络搜索引擎的漫游器（又称网络蜘蛛），此网站中的哪些内容是不应被搜索引擎的漫游器获取的，哪些是可以被漫游器获取的。因为一些系统中的URL是大小写敏感的，所以robots.txt的文件名应统一为小写。robots.txt应放置于网站的根目录下。如果想单独定义搜索引擎的漫游器访问子目录时的行为，那么可以将自定的设置合并到根目录下的robots.txt，或者使用robots元数据（Metadata，又称元数据）。</p>
</blockquote>
<p>先访问一下robots.txt文件：
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/robots.png alt=robots>
直接得到了flag。</p>
<h2 id=backup>backup</h2>
<p>X老师忘记删除备份文件，他派小宁同学去把备份文件找出来,一起来帮小宁同学吧！
考察的是备份文件，那么我们尝试访问<code>.bak</code>文件，发现可以下载，打开看看：
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/backup.png alt=backup></p>
<h2 id=cookie>cookie</h2>
<p>X老师告诉小宁他在cookie里放了些东西，小宁疑惑地想：‘这是夹心饼干的意思吗？’</p>
<p>考察cookie字段，cookie是包含在文件头中的一个字段，一般可以通过查看文件的响应头或者直接在控制台输入<code>document.cookie</code>查看该字段。
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/cookie1.png alt=cookie1>
让我们查看cookie.php，提示让查看相应头，可以看到有一个flag字段：
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/cookie2.png alt=cookie2></p>
<h2 id=disabled_button>disabled_button</h2>
<p>X老师今天上课讲了前端知识，然后给了大家一个不能按的按钮，小宁惊奇地发现这个按钮按不下去，到底怎么才能按下去呢？</p>
<p>打开控制台，定位到这个按钮，可以看到有一个disabled的属性，将其删除就可以点击：
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/disable.png alt=disable></p>
<h2 id=weak_auth>weak_auth</h2>
<p>小宁写了一个登陆验证页面，随手就设了一个密码。</p>
<p>根据题目提示，应该是弱密码，直接爆破：
最终结果密码为123456.</p>
<h2 id=simple_php>simple_php</h2>
<p>小宁听说php是最好的语言,于是她简单学习之后写了几行php代码。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#a6e22e>show_source</span>(<span style=color:#66d9ef>__FILE__</span>);
<span style=color:#66d9ef>include</span>(<span style=color:#e6db74>&#34;config.php&#34;</span>);
$a<span style=color:#f92672>=@</span>$_GET[<span style=color:#e6db74>&#39;a&#39;</span>];
$b<span style=color:#f92672>=@</span>$_GET[<span style=color:#e6db74>&#39;b&#39;</span>];
<span style=color:#66d9ef>if</span>($a<span style=color:#f92672>==</span><span style=color:#ae81ff>0</span> <span style=color:#66d9ef>and</span> $a){
    <span style=color:#66d9ef>echo</span> $flag1;
}
<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>is_numeric</span>($b)){
    <span style=color:#66d9ef>exit</span>();
}
<span style=color:#66d9ef>if</span>($b<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>1234</span>){
    <span style=color:#66d9ef>echo</span> $flag2;
}
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>根据源码，flag被分成了两部分，分别当满足a==0且a不为false和b>1234且b不是数字的时候出现。这一题考的是php的弱类型。
首先要求a==0并且a不能等于false，那么肯定不能直接让a=0，由于两个<code>==</code>仅比较大小不比较类型，那么可以让 <code>a='0'</code>，这样a就不为false了，事实上，对于php的比较，0与任何不能转化为数字的字符串比较都相等，因此我们设置也可以<code>a=a</code>。
对于b，is_numeric()会检查是否为数字或数字字符串，那么简单的将一个大于1234的值加上引号也是不行的。所以这里再数字后面加上一个字母，就可以绕过这个检查，因此最终构造payload为：</p>
<pre><code>/index.php?a=a&amp;b=12345a
</code></pre>
<p>得到flag。</p>
<h2 id=get_post>get_post</h2>
<p>X老师告诉小宁同学HTTP通常使用两种请求方法，你知道是哪两种吗？</p>
<p>这一道题考的是两种表单提交的方式，Get方式会直接显示在浏览器的url中，因此可以直接通过修改URL来实现，但是post就相对麻烦了些，需要我们修改请求头。但是可以有更简单的方法，那就是使用hackbar插件：
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/get_post.png alt=get_post>
运行就能返回flag。</p>
<h2 id=xff_referer>xff_referer</h2>
<p>X老师告诉小宁其实xff和referer是可以伪造的。</p>
<p>考察xff和referer。X-Forwarded-For（XFF）是用来识别通过HTTP代理或负载均衡方式连接到Web服务器的客户端最原始的IP地址的HTTP请求头字段。referer用来检查网页的来源地址。</p>
<p>一开始显示要求ip为123.123.123.123，那就是需要修改xff为123.123.123.123，重发之后还是不能获取flag，查看源码发现还要求必须来自https://www.google.com，因此添加referer头为https://www.google.com：
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/xff_referer.png alt=xff_referer>
需要注意的是flag并没有直接显示在页面上，继续后拉源码可以看到flag：
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/xff_flag.png alt=xff_flag></p>
<h2 id=webshell>webshell</h2>
<p>小宁百度了php一句话,觉着很有意思,并且把它放在index.php里。</p>
<p>提示的很明显，是一句话木马：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#a6e22e>你会使用webshell吗？</span>
<span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> <span style=color:#f92672>@</span><span style=color:#66d9ef>eval</span>($_POST[<span style=color:#e6db74>&#39;shell&#39;</span>]);<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010>
</span></code></pre></div><p>很显然，是一句话木马，而且连接密码为shell，使用菜刀等软件链接就行了：
<img src=http://ctf-qn.hufl.top//ADWorld/03/08/webshell.png alt=webshell>
可以直接找到flag。</p>
<h2 id=command_execution>command_execution</h2>
<p>小宁写了个ping功能,但没有写waf,X老师告诉她这是非常危险的，你知道为什么吗。</p>
<p>考察命令执行：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>; find / -name flag*
</code></pre></div><p><img src=http://ctf-qn.hufl.top//ADWorld/03/08/command.png alt=command>
可以看到flag就在home下，直接输出就行了：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>; cat /home/flag.txt
</code></pre></div><h2 id=simple_js>simple_js</h2>
<p>小宁发现了一个网页，但却一直输不对密码。(Flag格式为 Cyberpeace{xxxxxxxxx} )</p>
<p>进入是一个弹窗，要求输入密码，根据提示一直输不对，猜测应该不会是暴力破解。但是可在源代码中发现这个函数：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>script</span> <span style=color:#a6e22e>type</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;text/javascript&#34;</span><span style=color:#f92672>&gt;</span>
    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>dechiffre</span>(<span style=color:#a6e22e>pass_enc</span>){
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>pass</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;70,65,85,88,32,80,65,83,83,87,79,82,68,32,72,65,72,65&#34;</span>;
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tab</span>  <span style=color:#f92672>=</span> <span style=color:#a6e22e>pass_enc</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;,&#39;</span>);
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>tab2</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>pass</span>.<span style=color:#a6e22e>split</span>(<span style=color:#e6db74>&#39;,&#39;</span>);
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span>,<span style=color:#a6e22e>j</span>,<span style=color:#a6e22e>k</span>,<span style=color:#a6e22e>l</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>,<span style=color:#a6e22e>m</span>,<span style=color:#a6e22e>n</span>,<span style=color:#a6e22e>o</span>,<span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>;
        
        <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab</span>.<span style=color:#a6e22e>length</span>;
        <span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>l</span>) <span style=color:#f92672>+</span> (<span style=color:#a6e22e>n</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>);
        <span style=color:#a6e22e>n</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab2</span>.<span style=color:#a6e22e>length</span>;
        
        <span style=color:#66d9ef>for</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>o</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>); <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>n</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> ){
            <span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>-</span><span style=color:#a6e22e>l</span>];
            <span style=color:#a6e22e>p</span> <span style=color:#f92672>+=</span> String.<span style=color:#a6e22e>fromCharCode</span>((<span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab2</span>[<span style=color:#a6e22e>i</span>]));
            <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>==</span> <span style=color:#ae81ff>5</span>)
                <span style=color:#66d9ef>break</span>;
        }
        <span style=color:#66d9ef>for</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>o</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>); <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> (<span style=color:#a6e22e>k</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>j</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>n</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> ){
            <span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>-</span><span style=color:#a6e22e>l</span>];
            <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>i</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>5</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>k</span><span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
                <span style=color:#a6e22e>p</span> <span style=color:#f92672>+=</span> String.<span style=color:#a6e22e>fromCharCode</span>((<span style=color:#a6e22e>o</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>tab2</span>[<span style=color:#a6e22e>i</span>]));
        }
        <span style=color:#a6e22e>p</span> <span style=color:#f92672>+=</span> String.<span style=color:#a6e22e>fromCharCode</span>(<span style=color:#a6e22e>tab2</span>[<span style=color:#ae81ff>17</span>]);
        <span style=color:#a6e22e>pass</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>p</span>;
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>pass</span>;
    }

    String[<span style=color:#e6db74>&#34;fromCharCode&#34;</span>](<span style=color:#a6e22e>dechiffre</span>(<span style=color:#e6db74>&#34;\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30&#34;</span>));

    <span style=color:#a6e22e>h</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>prompt</span>(<span style=color:#e6db74>&#39;Enter password&#39;</span>);
    <span style=color:#a6e22e>alert</span>( <span style=color:#a6e22e>dechiffre</span>(<span style=color:#a6e22e>h</span>) );

<span style=color:#f92672>&lt;</span><span style=color:#960050;background-color:#1e0010>/script&gt;</span>
</code></pre></div><p>那么就是考察js代码审计了，真正的密码在fromCharCode中，先对其进行处理，可以得到对应的字符串为：</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>&gt;&gt;&gt;</span> s <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;</span><span style=color:#ae81ff>\x35\x35\x2c\x35\x36\x2c\x35\x34\x2c\x37\x39\x2c\x31\x31\x35\x2c\x36\x39\x2c\x31\x31\x34\x2c\x31\x31\x36\x2c\x31\x30\x37\x2c\x34\x39\x2c\x35\x30</span><span style=color:#e6db74>&#34;</span>
<span style=color:#f92672>&gt;&gt;&gt;</span> s
<span style=color:#e6db74>&#39;55,56,54,79,115,69,114,116,107,49,50&#39;</span>
<span style=color:#f92672>&gt;&gt;&gt;</span> a<span style=color:#f92672>=</span> [<span style=color:#ae81ff>55</span>,<span style=color:#ae81ff>56</span>,<span style=color:#ae81ff>54</span>,<span style=color:#ae81ff>79</span>,<span style=color:#ae81ff>115</span>,<span style=color:#ae81ff>69</span>,<span style=color:#ae81ff>114</span>,<span style=color:#ae81ff>116</span>,<span style=color:#ae81ff>107</span>,<span style=color:#ae81ff>49</span>,<span style=color:#ae81ff>50</span>]
<span style=color:#f92672>&gt;&gt;&gt;</span> c<span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
<span style=color:#f92672>&gt;&gt;&gt;</span> <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> a:
<span style=color:#f92672>...</span>     c <span style=color:#f92672>+=</span> chr(i)
<span style=color:#f92672>...</span>
<span style=color:#f92672>&gt;&gt;&gt;</span> print(c)
<span style=color:#ae81ff>786</span>OsErtk12
</code></pre></div><p>将其按照搁置包裹起来即可得到flag。</p>
</div>
</div>
<div class=w-200>
<div id=gitalk></div>
<script>var gitalk=new Gitalk({clientID:'9a04c6b451fbce76511d',clientSecret:'430c540c77ecd6b59749c60f0341c057bd5320a0',repo:'Causa1ity.github.io',owner:'Causa1ity',admin:'Causa1ity',id:'https://causality.top/security/writeups/adworld/',distractionFreeMode:!1});gitalk.render('gitalk')</script>
</div>
</div>
</div>
<script>CodeLine.initOnPageLoad({copyBtn:{show:!0,position:'top'},toggleBtn:{show:!1}})</script>
<div class="text-center my-8">
<span class="font-serif text-lg">
Powered By <a href=https://gohugo.io/ class="font-bold hover:text-blue-400">Hugo</a>
with theme <a href=https://github.com/causa1ity/hugo-theme-noth/ class="font-bold hover:text-blue-400">Noth</a>
</span>
</div></body>
</html>